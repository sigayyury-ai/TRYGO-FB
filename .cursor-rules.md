# Правила разработки для AI Assistant

## Проверка логов и ошибок

1. **Когда пользователь просит проверить логи:**
   - СНАЧАЛА проверяй ошибки компиляции/рантайма, которые пользователь показывает
   - Затем проверяй соответствующие файлы и строки кода
   - Не переключайся на другие логи (бэкенд/терминал), если не указано явно

2. **При получении ошибок компиляции:**
   - Сразу открывай указанный файл
   - Находи проблему на указанных строках
   - Исправляй, а не ищи логи в других местах

3. **Когда пользователь показывает конкретную ошибку:**
   - Фокусируйся на этой ошибке
   - Не делай лишних проверок других частей кода без необходимости

4. **КРИТИЧЕСКИ ВАЖНО: Проверка работоспособности перед утверждением:**
   - **НИКОГДА не утверждай, что что-то "работает" или "исправлено" без фактической проверки логов**
   - Перед тем как сказать "всё работает" или "проблема исправлена", ОБЯЗАТЕЛЬНО:
     - Проверь логи бэкенда (если речь о бэкенд функциональности)
     - Проверь логи фронтенда (если речь о фронтенд функциональности)
     - Проверь терминальные логи процессов
     - Проверь наличие ошибок компиляции/рантайма
     - Проверь что процессы действительно запущены (ps, lsof)
     - Проверь что API эндпоинты отвечают (curl, если возможно)
   - Если не можешь проверить логи - скажи об этом явно: "Не могу проверить логи сейчас, но изменения применены. Пожалуйста, проверьте вручную"
   - Частый кейс: AI утверждает что работает, а на самом деле не работает - ЭТО НЕДОПУСТИМО

5. **Минимальные изменения:**
   - Делай только необходимые изменения для исправления проблемы
   - Не переписывай большие части кода без явной необходимости
   - Сообщай о дублировании кода, если видишь проблему

6. **Генерация отчетов, чек-листов и документации:**
   - **НИКОГДА не создавай MD файлы с отчетами, исследованиями, анализом, чек-листами без явного запроса пользователя**
   - Не создавай файлы типа: `*_REPORT.md`, `*_RESEARCH.md`, `*_ANALYSIS.md`, `*_ROADMAP.md`, `*_CHECK.md`, `*_CHECKLIST.md`, `*_SUMMARY.md`, `*_STATUS.md`
   - Не создавай отчеты о проделанной работе, сводки изменений, аналитические отчеты
   - Не создавай чек-листы для проверки, документы с результатами проверок
   - Если нужна документация/отчет/чек-лист - сначала спроси пользователя или дождись явного запроса
   - Исключение: только если пользователь явно просит создать отчет/документацию/чек-лист

## GraphQL Schema и Resolvers - Критически важно!

**ВСЕГДА добавлять в паре:**
- При добавлении нового resolver в `resolvers.ts` → ОБЯЗАТЕЛЬНО добавить соответствующее определение в `typeDefs.ts` (Query/Mutation)
- При добавлении нового типа/input в `typeDefs.ts` → ОБЯЗАТЕЛЬНО проверить, что все resolvers используют правильные типы

**Почему это критично:**
- Apollo Server проверяет соответствие схемы и resolvers при старте
- Если resolver есть, а определения в схеме нет (или наоборот) → бэкенд НЕ ЗАПУСТИТСЯ
- Ошибка: `Query.X defined in resolvers, but not in schema` или `Unknown type "X"`
- Бэкенд падает с `ERR_CONNECTION_REFUSED` на фронтенде

**Порядок действий:**
1. Сначала добавить определение в `typeDefs.ts` (Query/Mutation/Input/Type)
2. Затем добавить resolver в `resolvers.ts`
3. Проверить логи при старте бэкенда - Apollo Server выводит ошибки валидации
4. Если бэкенд не запускается - проверить соответствие схемы и resolvers

**Пример правильного подхода:**
```typescript
// 1. Сначала в typeDefs.ts
type Query {
  contentItemByBacklogIdea(backlogIdeaId: ID!): ContentItem
}

input ApproveContentItemInput {
  contentItemId: ID!
  projectId: ID!
  hypothesisId: ID
}

// 2. Затем в resolvers.ts
Query: {
  contentItemByBacklogIdea: async (_, { backlogIdeaId }) => { ... }
}

Mutation: {
  approveContentItem: async (_, { input }: { input: ApproveContentItemInput }) => { ... }
}
```

**Проверка перед коммитом:**
- Убедиться, что бэкенд запускается без ошибок
- Проверить логи: `tail -f logs/backend.log | grep -E "ready|Error|Failed"`
- Все GraphQL queries/mutations должны быть определены в схеме

## Конфигурация портов и запросов

1. **КРИТИЧЕСКИ ВАЖНО: Порты и запросы**
   - **НИКОГДА не меняй порты** без обновления PORTS.md и .env файлов
   - **НИКОГДА не создавай новые порты** без добавления их в PORTS.md
   - **ВСЕГДА используй порты из PORTS.md** - это единственный источник правды
   - Перед изменением порта - проверь PORTS.md и убедись, что изменение необходимо

2. **Правила использования Apollo Clients:**
   - **SEO Agent запросы** (14 файлов) → используют `SEO_AGENT_QUERY` / `SEO_AGENT_MUTATE` → порт **4100**
   - **Все остальные запросы** → используют `QUERY` / `MUTATE` → порт **5001**
   - **НИКОГДА не смешивай** клиенты - SEO Agent запросы НЕ должны использовать обычный QUERY/MUTATE

3. **Актуальные порты (из PORTS.md):**
   - Main Backend: **5001** → `VITE_SERVER_URL` → используется в `TRYGO-Front/src/config/apollo/client/index.ts`
   - SEO Agent Backend: **4100** → `VITE_SEO_AGENT_URL` → используется в `TRYGO-Front/src/config/apollo/client/seoAgentClient.ts`
   - WebSocket: **5001** → `VITE_WS_SERVER_URL`
   - Semantics Service: **4200** → `SEMANTICS_SERVICE_URL` (только в backend)
   - Images Service: **4300** → `IMAGES_SERVICE_URL` (только в backend)
   - Website Pages Service: **4400** → `WEBSITE_PAGES_SERVICE_URL` (только в backend)
   - Frontend: **8080** (или 5173 для Vite по умолчанию)

4. **При работе с портами:**
   - СНАЧАЛА проверь PORTS.md - там актуальный список
   - Затем проверь .env файлы - они должны соответствовать PORTS.md
   - Если нужно изменить порт - обнови ОБА файла (PORTS.md и .env)
   - НЕ затирай существующие настройки портов
   - НЕ используй разные порты в разных местах для одного сервиса

5. **SEO Agent API файлы (используют порт 4100):**
   - getSeoAgentBacklog.ts, updateSeoAgentBacklogItem.ts, deleteSeoAgentBacklogItem.ts
   - getSeoAgentContentIdeas.ts, addContentIdeaToBacklog.ts, dismissContentIdea.ts, createCustomContentIdea.ts
   - getSeoAgentClusters.ts, createSeoAgentCluster.ts, updateSeoAgentCluster.ts, deleteSeoAgentCluster.ts
   - getSeoAgentPostingSettings.ts, updateSeoAgentPostingSettings.ts, getSeoAgentContext.ts

## Примеры

### Пример 1: Проверка ошибок компиляции

**Неправильно:**
- Пользователь показывает ошибку компиляции в `MonthlySchedule.tsx:124`
- AI начинает проверять логи бэкенда в терминале
- Игнорирует указанную ошибку

**Правильно:**
- Пользователь показывает ошибку компиляции в `MonthlySchedule.tsx:124`
- AI сразу открывает файл `MonthlySchedule.tsx`
- Проверяет строку 124 и находит проблему
- Исправляет проблему

### Пример 2: Утверждение о работоспособности БЕЗ проверки логов

**Неправильно:**
- AI исправляет код
- AI говорит: "✅ Всё исправлено, авторизация теперь работает"
- НЕ проверяет логи бэкенда
- НЕ проверяет логи фронтенда
- НЕ проверяет что процессы запущены
- НЕ проверяет что API отвечает
- Пользователь пытается использовать - не работает

**Правильно:**
- AI исправляет код
- AI проверяет логи бэкенда: `tail -50 logs/backend.log` или `/tmp/trygo-backend.log`
- AI проверяет что бэкенд запущен: `lsof -ti:5001`
- AI проверяет что GraphQL отвечает: `curl http://localhost:5001/graphql`
- AI проверяет логи фронтенда на ошибки
- ТОЛЬКО после проверки говорит: "✅ Исправлено. Проверил логи - ошибок нет, бэкенд отвечает. Попробуйте авторизоваться"
- Если не может проверить: "✅ Изменения применены. НЕ МОГУ проверить логи сейчас - пожалуйста, проверьте вручную в консоли браузера и терминале"

