# ============================================
# TRYGO Platform - Render Deployment Configuration
# ============================================
# 
# ВАЖНО:
# - semantics-service и images-service закомментированы (их нет в проекте)
# - Если вы создадите эти сервисы, раскомментируйте соответствующие блоки
# - SEMANTICS_SERVICE_URL и IMAGES_SERVICE_URL нужно установить вручную в Render Dashboard
#
# Для деплоя:
# 1. Подключите репозиторий в Render Dashboard
# 2. Выберите "New Blueprint" и укажите этот файл
# 3. Установите все переменные окружения с sync: false
#
# Подробная инструкция: см. DEPLOY_RENDER.md
# ============================================

services:
  # ============================================
  # SEO Agent Backend (GraphQL API)
  # Основной бэкенд для SEO Agent функциональности
  # ============================================
  - type: web
    name: seo-agent-backend
    runtime: node
    region: frankfurt
    plan: starter
    rootDir: backend
    buildCommand: npm install && npm run build
    startCommand: npm start
    healthCheckPath: /health
    envVars:
      - key: NODE_ENV
        value: production
      - key: MONGODB_URI
        value: ""
        sync: false
      - key: OPENAI_API_KEY
        value: ""
        sync: false
      - key: OPENAI_MODEL
        value: gpt-4o-mini
      - key: OPENAI_IMAGE_MODEL
        value: dall-e-2
      - key: FRONTEND_URL
        value: ""
        sync: false
      - key: SEMANTICS_SERVICE_URL
        value: ""
        sync: false
      - key: IMAGES_SERVICE_URL
        value: ""
        sync: false
      - key: WEBSITE_PAGES_SERVICE_URL
        value: ""
        sync: false
      - key: IMAGE_PROVIDER
        value: openai
      - key: WORDPRESS_BASE_URL
        value: ""
        sync: false
      - key: WORDPRESS_USERNAME
        value: ""
        sync: false
      - key: WORDPRESS_APP_PASSWORD
        value: ""
        sync: false
      - key: GOOGLE_API_KEY
        value: ""
        sync: false
      - key: GEMINI_API_KEY
        value: ""
        sync: false

  # ============================================
  # Main Backend (TRYGO-Backend)
  # Основной бэкенд для авторизации, проектов, гипотез
  # ============================================
  - type: web
    name: trygo-main-backend
    runtime: node
    region: frankfurt
    plan: starter
    rootDir: TRYGO-Backend
    buildCommand: npm install && npm run build && npm run codegen
    startCommand: npm start
    healthCheckPath: /health
    envVars:
      - key: NODE_ENV
        value: production
      - key: MONGODB_URI
        value: ""
        sync: false
      - key: OPENAI_API_KEY
        value: ""
        sync: false
      - key: JWT_SECRET
        value: ""
        sync: false
      - key: STRIPE_SECRET_KEY
        value: ""
        sync: false
      - key: STRIPE_STARTER_MONTHLY_PRICE_ID
        value: ""
        sync: false
      - key: STRIPE_PRO_MONTHLY_PRICE_ID
        value: ""
        sync: false
      - key: STRIPE_WEBHOOK_SECRET
        value: ""
        sync: false
      - key: FRONTEND_URL
        value: ""
        sync: false
      - key: DEVELOPMENT_FRONTEND_URL
        value: ""
        sync: false
      - key: PRODUCTION_FRONTEND_URL
        value: ""
        sync: false
      - key: CORS_ENABLED
        value: "true"
      - key: GOOGLE_AUTH_CLIENT_ID
        value: ""
        sync: false
      - key: GOOGLE_AUTH_CLIENT_SECRET
        value: ""
        sync: false
      - key: AWS_ACCESS_KEY
        value: ""
        sync: false
      - key: AWS_SECRET_ACCESS_KEY
        value: ""
        sync: false
      - key: AWS_REGION
        value: ""
        sync: false
      - key: AWS_BUCKET_NAME
        value: ""
        sync: false
      - key: MAILT_API_KEY
        value: ""
        sync: false
      - key: MAILT_EMAIL_ADDRESS
        value: ""
        sync: false
      - key: MAILT_FROM_NAME
        value: ""
        sync: false
      - key: BOUNCER_CHECK_API_KEY
        value: ""
        sync: false
      - key: TG_CHAT_ID_STATISTICS
        value: ""
        sync: false
      - key: TG_CHAT_ID_ERROR
        value: ""
        sync: false
      - key: TG_TOKEN_STATISTICS
        value: ""
        sync: false
      - key: TG_ENABLED
        value: ""
        sync: false

  # ============================================
  # Frontend (React SPA)
  # Веб-сервис, запускающий Vite preview сервер
  # ============================================
  - type: web
    name: trygo-frontend
    runtime: node
    region: frankfurt
    plan: starter
    rootDir: TRYGO-Front
    buildCommand: npm install && npm run build
    startCommand: npm run preview -- --host 0.0.0.0 --port $PORT
    envVars:
      - key: VITE_SERVER_URL
        value: ""
        sync: false
      - key: VITE_SEO_AGENT_URL
        value: ""
        sync: false
      - key: VITE_WS_SERVER_URL
        value: ""
        sync: false
      - key: VITE_GOOGLE_CLIENT_ID
        value: ""
        sync: false
      - key: VITE_SEO_AGENT_ENABLED
        value: "true"
      - key: VITE_SEO_AGENT_DEV_SHELL
        value: "false"
      - key: VITE_SEO_AGENT_UI_TESTING
        value: "false"

  # ============================================
  # Website Pages Service
  # Микросервис для генерации веб-страниц
  # ============================================
  - type: web
    name: website-pages-service
    runtime: node
    region: frankfurt
    plan: starter
    rootDir: website-pages-service
    buildCommand: npm install && npm run build
    startCommand: npm start
    healthCheckPath: /health
    envVars:
      - key: NODE_ENV
        value: production
      - key: PORT
        value: "4400"
      - key: OPENAI_API_KEY
        value: ""
        sync: false

  # ============================================
  # Semantics Service
  # Микросервис для работы с семантическими кластерами
  # ============================================
  - type: web
    name: semantics-service
    runtime: node
    region: frankfurt
    plan: starter
    rootDir: semantics-service
    buildCommand: npm install && npm run build
    startCommand: npm start
    healthCheckPath: /health
    envVars:
      - key: NODE_ENV
        value: production
      - key: PORT
        value: "4200"
      - key: MONGODB_URI
        value: ""
        sync: false
      - key: SEMANTICS_SERVICE_ORIGIN
        value: ""
        sync: false

  # ============================================
  # Images Service
  # Микросервис для генерации изображений
  # ============================================
  - type: web
    name: images-service
    runtime: node
    region: frankfurt
    plan: starter
    rootDir: images-service
    buildCommand: npm install && npm run build
    startCommand: npm start
    healthCheckPath: /
    envVars:
      - key: NODE_ENV
        value: production
      - key: PORT
        value: "4300"
      - key: OPENAI_API_KEY
        value: ""
        sync: false
      - key: GEMINI_API_KEY
        value: ""
        sync: false
      - key: IMAGE_PROVIDER
        value: openai
      - key: OPENAI_IMAGE_MODEL
        value: dall-e-2
      - key: GEMINI_IMAGE_MODEL
        value: gemini-2.5-flash-image
      - key: GEMINI_API_BASE_URL
        value: https://generativelanguage.googleapis.com/v1beta
      - key: PUBLIC_URL
        value: ""
        sync: false
      - key: STORAGE_ROOT
        value: ./storage
