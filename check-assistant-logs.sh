#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ª–æ–≥–æ–≤ AI Assistant

echo "üîç –ü–†–û–í–ï–†–ö–ê –õ–û–ì–û–í AI ASSISTANT"
echo "================================"
echo ""

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –≥–¥–µ –∑–∞–ø—É—â–µ–Ω –±—ç–∫–µ–Ω–¥
BACKEND_PID=$(lsof -ti:5001 2>/dev/null)
if [ -z "$BACKEND_PID" ]; then
    echo "‚ùå –ë—ç–∫–µ–Ω–¥ –Ω–µ –∑–∞–ø—É—â–µ–Ω –Ω–∞ –ø–æ—Ä—Ç—É 5001"
    echo ""
    exit 1
fi

echo "‚úÖ –ë—ç–∫–µ–Ω–¥ –∑–∞–ø—É—â–µ–Ω (PID: $BACKEND_PID)"
echo ""

# –ü–æ–∏—Å–∫ –ª–æ–≥–æ–≤
LOG_FILES=(
    "/tmp/trygo-backend.log"
    "$(pwd)/TRYGO-Backend/logs/backend.log"
    "$(pwd)/logs/backend.log"
    "$(pwd)/backend.log"
)

FOUND_LOG=""
for log_file in "${LOG_FILES[@]}"; do
    if [ -f "$log_file" ]; then
        FOUND_LOG="$log_file"
        echo "üìÑ –ù–∞–π–¥–µ–Ω –ª–æ–≥ —Ñ–∞–π–ª: $log_file"
        break
    fi
done

if [ -z "$FOUND_LOG" ]; then
    echo "‚ö†Ô∏è  –õ–æ–≥ —Ñ–∞–π–ª—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã, –ø—Ä–æ–≤–µ—Ä—è—é –≤—ã–≤–æ–¥ –ø—Ä–æ—Ü–µ—Å—Å–∞..."
    echo ""
    
    # –ü—Ä–æ–±—É–µ–º –ø–æ–ª—É—á–∏—Ç—å –ª–æ–≥–∏ –∏–∑ –≤—ã–≤–æ–¥–∞ –ø—Ä–æ—Ü–µ—Å—Å–∞ (–µ—Å–ª–∏ –∑–∞–ø—É—â–µ–Ω –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ)
    echo "–ü–æ—Å–ª–µ–¥–Ω–∏–µ –ª–æ–≥–∏ –ø—Ä–æ—Ü–µ—Å—Å–∞ (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω—ã):"
    echo "----------------------------------------"
    # –≠—Ç–æ –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–µ—Ç –µ—Å–ª–∏ –ø—Ä–æ—Ü–µ—Å—Å –∑–∞–ø—É—â–µ–Ω –Ω–µ –∏–∑ —Ç–µ–∫—É—â–µ–≥–æ —Ç–µ—Ä–º–∏–Ω–∞–ª–∞
    echo "üí° –ó–∞–ø—É—Å—Ç–∏—Ç–µ –±—ç–∫–µ–Ω–¥ –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ –∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –µ–≥–æ –≤—ã–≤–æ–¥"
    echo ""
    exit 0
fi

echo ""
echo "üîç –ü–û–ò–°–ö –°–û–û–ë–©–ï–ù–ò–ô –û AI ASSISTANT"
echo "=================================="
echo ""

# –ü–æ–∏—Å–∫ –≤—Å–µ—Ö —Å–æ–æ–±—â–µ–Ω–∏–π —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Å –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–æ–º
echo "üìã –ü–æ—Å–ª–µ–¥–Ω–∏–µ 50 —Å–æ–æ–±—â–µ–Ω–∏–π –æ createMessage:"
grep -i "createMessage" "$FOUND_LOG" | tail -50 || echo "  (–Ω–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–π)"

echo ""
echo "üìã –ü–æ—Å–ª–µ–¥–Ω–∏–µ 50 —Å–æ–æ–±—â–µ–Ω–∏–π –æ OpenAI/ChatGPT:"
grep -i -E "openai|chatgpt|gpt" "$FOUND_LOG" | tail -50 || echo "  (–Ω–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–π)"

echo ""
echo "üìã –ü–æ—Å–ª–µ–¥–Ω–∏–µ –æ—à–∏–±–∫–∏:"
grep -i -E "error|–æ—à–∏–±–∫–∞|exception" "$FOUND_LOG" | tail -30 || echo "  (–Ω–µ—Ç –æ—à–∏–±–æ–∫)"

echo ""
echo "üìã –ü–æ—Å–ª–µ–¥–Ω–∏–µ 100 —Å—Ç—Ä–æ–∫ –ª–æ–≥–∞:"
tail -100 "$FOUND_LOG"

echo ""
echo "‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞"






