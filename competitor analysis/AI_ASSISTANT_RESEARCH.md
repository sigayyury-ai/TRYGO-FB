# –ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ –ª–æ–≥–∏–∫–∏ AI Assistant

**–î–∞—Ç–∞**: 2025-01-XX  
**–¶–µ–ª—å**: –í—ã—è–≤–∏—Ç—å –ø—Ä–æ–±–ª–µ–º—ã –≤ —Ä–∞–±–æ—Ç–µ AI Assistant –∏ –ø–æ–Ω—è—Ç—å –ø–æ–ª–Ω—ã–π –ø–æ—Ç–æ–∫ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π

## üìä –ü–æ–ª–Ω—ã–π –ø–æ—Ç–æ–∫ —Ä–∞–±–æ—Ç—ã AI Assistant

### 1. –ö–ª–∏–µ–Ω—Ç (Frontend)

#### 1.1 –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è (`AIAssistantChat.tsx`)
```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ
  ‚Üì
handleSendMessage()
  ‚Üì
–ü—Ä–æ–≤–µ—Ä–∫–∞: canSendMessage() (–ø–æ–¥–ø–∏—Å–∫–∞)
  ‚Üì
sendChatMessage(input) –∏–∑ useSocketStore
```

#### 1.2 Socket.IO –æ—Ç–ø—Ä–∞–≤–∫–∞ (`useSocketStore.ts`)
```typescript
sendChatMessage(input) {
  1. –ü—Ä–æ–≤–µ—Ä–∫–∞: socket —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏ –ø–æ–¥–∫–ª—é—á–µ–Ω?
  2. –ï—Å–ª–∏ –Ω–µ—Ç ‚Üí initSocket() (lazy initialization)
  3. socket.emit("createMessage", input)
  4. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç: chatLoading = true
}
```

**–ü—Ä–æ–±–ª–µ–º–∞ #1**: –ï—Å–ª–∏ socket –Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω, —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è `onConnect` handler, –Ω–æ –Ω–µ—Ç —Ç–∞–π–º–∞—É—Ç–∞ –Ω–∞ —Å–ª—É—á–∞–π –µ—Å–ª–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –Ω–µ –ø—Ä–æ–∏–∑–æ–π–¥–µ—Ç.

#### 1.3 –ü–æ–ª—É—á–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç–∞ (`useSocketStore.ts` + `AIAssistantChat.tsx`)
```typescript
// –í useSocketStore:
socket.on("answerCreated", (data) => {
  set({ chatLoading: false, chatError: null });
  // –û–±–Ω–æ–≤–ª—è–µ—Ç —Å—á–µ—Ç—á–∏–∫ —Å–æ–æ–±—â–µ–Ω–∏–π
  // –û–±–Ω–æ–≤–ª—è–µ—Ç core –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
});

// –í AIAssistantChat:
socket.on("answerCreated", (data) => {
  setMessages([...messages, { text: data.message, sender: "ai" }]);
});
```

**–ü—Ä–æ–±–ª–µ–º–∞ #2**: –î–≤–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ `answerCreated` - –æ–¥–∏–Ω –≤ store, –¥—Ä—É–≥–æ–π –≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–µ. –ú–æ–∂–µ—Ç –±—ã—Ç—å –∫–æ–Ω—Ñ–ª–∏–∫—Ç.

---

### 2. –°–µ—Ä–≤–µ—Ä (Backend)

#### 2.1 –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è (`setupSocketIOServer.ts`)
```typescript
socket.on("createMessage", async (input) => {
  await createMessage({ socket, input, userId });
});
```

**–°—Ç–∞—Ç—É—Å**: –î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ `[Socket.IO] –ü–æ–ª—É—á–µ–Ω–æ —Å–æ–±—ã—Ç–∏–µ createMessage`

#### 2.2 –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è (`createMessage.ts`)
```typescript
createMessage() {
  1. checkIfMessagesAllowed(userId) - –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∫–∏
  2. –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–∞ —Å–æ–æ–±—â–µ–Ω–∏—è (MessageType)
  3. –í—ã–∑–æ–≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–≥–æ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞:
     - createLeanCanvasMessage()
     - createPersonProfileMessage()
     - createMarketResearchMessage()
     - –∏ —Ç.–¥.
  4. incrementGeneratedMessages(userId)
  5. socket.emit("answerCreated", { message, id })
}
```

**–°—Ç–∞—Ç—É—Å**: –î–æ–±–∞–≤–ª–µ–Ω–æ –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ –∫–∞–∂–¥–æ–º —ç—Ç–∞–ø–µ

#### 2.3 –û–±—Ä–∞–±–æ—Ç–∫–∞ Lean Canvas (`createLeanCanvasMessage.ts`)
```typescript
createLeanCanvasMessage() {
  1. –ü–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞: projectService.getProjectById()
  2. –ü–æ–ª—É—á–µ–Ω–∏–µ –≥–∏–ø–æ—Ç–µ–∑—ã: hypothesesCoreService.getHypothesesCore()
  3. –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–∞: prompts.createLeanCanvasMessage()
  4. –í—ã–∑–æ–≤ OpenAI:
     chatGPTService.createAnswerWithThreadJsonSchema(
       JsonSchemaType.LEAN_CANVAS_MESSAGE,
       prompt,
       project.assistantId,
       hypothesesCore.threadId,
       20000,
       { wantToChangeInfo }
     )
  5. –ï—Å–ª–∏ wantToChangeInfo ‚Üí –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ hypothesesCore
  6. –í–æ–∑–≤—Ä–∞—Ç: aiResponse.response.message
}
```

**–ü—Ä–æ–±–ª–µ–º–∞ #3**: –ï—Å–ª–∏ `project.assistantId` –∏–ª–∏ `hypothesesCore.threadId` –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç - –±—É–¥–µ—Ç –æ—à–∏–±–∫–∞.

#### 2.4 OpenAI API –≤—ã–∑–æ–≤ (`ChatGPTService.ts`)

##### –ú–µ—Ç–æ–¥: `createAnswerWithThreadJsonSchema`
```typescript
createAnswerWithThreadJsonSchema() {
  1. –ü–æ–ª—É—á–µ–Ω–∏–µ JSON —Å—Ö–µ–º—ã: getJsonSchemaForType()
  2. –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –≤ —Ñ–æ—Ä–º–∞—Ç Assistant API:
     - responseFormat = { type: "json_schema", json_schema: {...} }
  3. –°–æ–∑–¥–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ thread:
     openai.beta.threads.messages.create(threadId, {
       role: 'user',
       content: prompt
     })
  4. –°–æ–∑–¥–∞–Ω–∏–µ run:
     openai.beta.threads.runs.create(threadId, {
       assistant_id: assistantId,
       response_format: responseFormat
     })
  5. –û–∂–∏–¥–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è:
     getMessageInThread(threadId, run.id)
}
```

##### –ú–µ—Ç–æ–¥: `getMessageInThread` (–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π)
```typescript
getMessageInThread(threadId, runId) {
  startTime = Date.now()
  timeout = 60000 (1 –º–∏–Ω—É—Ç–∞)
  
  while (Date.now() - startTime < timeout) {
    status = getRunObjectStatus(threadId, runId)
    
    if (status == 'completed') {
      return getCompletedMessage(threadId)
    }
    
    await sleep(500) // –ñ–¥–µ—Ç 500ms –ø–µ—Ä–µ–¥ —Å–ª–µ–¥—É—é—â–µ–π –ø—Ä–æ–≤–µ—Ä–∫–æ–π
  }
  
  throw new Error('Timeout: The operation did not complete within 1 minute.')
}
```

**–ü—Ä–æ–±–ª–µ–º–∞ #4**: –¢–∞–π–º–∞—É—Ç –≤—Å–µ–≥–æ 1 –º–∏–Ω—É—Ç–∞. –î–ª—è —Å–ª–æ–∂–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ OpenAI –º–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –¥–æ–ª—å—à–µ.

##### –ú–µ—Ç–æ–¥: `getRunObjectStatus`
```typescript
getRunObjectStatus(threadId, runId) {
  runObject = await openai.beta.threads.runs.retrieve(threadId, runId)
  return runObject.status
}
```

–í–æ–∑–º–æ–∂–Ω—ã–µ —Å—Ç–∞—Ç—É—Å—ã:
- `queued` - –≤ –æ—á–µ—Ä–µ–¥–∏
- `in_progress` - –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è
- `requires_action` - —Ç—Ä–µ–±—É–µ—Ç—Å—è –¥–µ–π—Å—Ç–≤–∏–µ
- `cancelling` - –æ—Ç–º–µ–Ω—è–µ—Ç—Å—è
- `cancelled` - –æ—Ç–º–µ–Ω–µ–Ω
- `failed` - –ø—Ä–æ–≤–∞–ª–µ–Ω
- `completed` - –∑–∞–≤–µ—Ä—à–µ–Ω
- `expired` - –∏—Å—Ç–µ–∫

**–ü—Ä–æ–±–ª–µ–º–∞ #5**: –ù–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å—Ç–∞—Ç—É—Å–æ–≤ `failed`, `cancelled`, `expired`, `requires_action`.

##### –ú–µ—Ç–æ–¥: `getCompletedMessage`
```typescript
getCompletedMessage(threadId) {
  1. –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π: openai.beta.threads.messages.list(threadId)
  2. –ü–∞—Ä—Å–∏–Ω–≥: messages[0][0].text.value
  3. parseJsonFromResponse() - –∏–∑–≤–ª–µ–∫–∞–µ—Ç JSON –∏–∑ —Ç–µ–∫—Å—Ç–∞
  4. return parsedResponse
}
```

**–ü—Ä–æ–±–ª–µ–º–∞ #6**: –ï—Å–ª–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –æ—Ç–≤–µ—Ç–∞ –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω–∞—è, `messages[0][0].text.value` –º–æ–∂–µ—Ç –±—ã—Ç—å undefined.

---

## üî¥ –í—ã—è–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

1. **–¢–∞–π–º–∞—É—Ç 1 –º–∏–Ω—É—Ç–∞ —Å–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–∏–π**
   - –î–ª—è —Å–ª–æ–∂–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ OpenAI –º–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å 2-3 –º–∏–Ω—É—Ç—ã
   - –†–µ—à–µ–Ω–∏–µ: –£–≤–µ–ª–∏—á–∏—Ç—å –¥–æ 3-5 –º–∏–Ω—É—Ç

2. **–ù–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫ —Å—Ç–∞—Ç—É—Å–æ–≤ run**
   - –ï—Å–ª–∏ —Å—Ç–∞—Ç—É—Å `failed`, `cancelled`, `expired` - –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è
   - –†–µ—à–µ–Ω–∏–µ: –î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –≤—Å–µ—Ö —Å—Ç–∞—Ç—É—Å–æ–≤

3. **–ù–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ `requires_action`**
   - Assistant –º–æ–∂–µ—Ç —Ç—Ä–µ–±–æ–≤–∞—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π
   - –†–µ—à–µ–Ω–∏–µ: –û–±—Ä–∞–±–æ—Ç–∞—Ç—å –∏–ª–∏ –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å

4. **–ü—Ä–æ–±–ª–µ–º—ã —Å threadId/assistantId**
   - –ï—Å–ª–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç - –±—É–¥–µ—Ç –æ—à–∏–±–∫–∞
   - –†–µ—à–µ–Ω–∏–µ: –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –∏ —Å–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏

### –°—Ä–µ–¥–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

5. **–î–≤–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ `answerCreated`**
   - –ú–æ–∂–µ—Ç –±—ã—Ç—å –∫–æ–Ω—Ñ–ª–∏–∫—Ç –∏–ª–∏ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ
   - –†–µ—à–µ–Ω–∏–µ: –û—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ –≤ store

6. **–ù–µ—Ç —Ç–∞–π–º–∞—É—Ç–∞ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ**
   - –ï—Å–ª–∏ socket –Ω–µ –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è - –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ–µ –æ–∂–∏–¥–∞–Ω–∏–µ
   - –†–µ—à–µ–Ω–∏–µ: –î–æ–±–∞–≤–∏—Ç—å —Ç–∞–π–º–∞—É—Ç 10 —Å–µ–∫—É–Ω–¥

7. **–ù–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ä–∞–∑—Ä—ã–≤–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –≤–æ –≤—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏**
   - –ï—Å–ª–∏ socket –æ—Ç–∫–ª—é—á–∏—Ç—Å—è - –∫–ª–∏–µ–Ω—Ç –Ω–µ –ø–æ–ª—É—á–∏—Ç –æ—Ç–≤–µ—Ç
   - –†–µ—à–µ–Ω–∏–µ: –•—Ä–∞–Ω–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ –ë–î –∏ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –ø—Ä–∏ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏

### –ú–µ–ª–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

8. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –≤ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –º–µ—Å—Ç–∞—Ö**
   - –†–µ—à–µ–Ω–∏–µ: –î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

9. **–ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ Socket.IO –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è**
   - –†–µ—à–µ–Ω–∏–µ: –£–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ lazy initialization, –Ω–æ –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

---

## üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —Ç–µ–∫—É—â–µ–π –ø—Ä–æ–±–ª–µ–º—ã

### –ß—Ç–æ –≤–∏–¥–Ω–æ –≤ –ª–æ–≥–∞—Ö:
- ‚ùå –ù–ï–¢ —Å–æ–æ–±—â–µ–Ω–∏–π `[Socket.IO] –ü–æ–ª—É—á–µ–Ω–æ —Å–æ–±—ã—Ç–∏–µ createMessage`
- ‚ùå –ù–ï–¢ —Å–æ–æ–±—â–µ–Ω–∏–π `[createMessage] –ù–∞—á–∞–ª–æ –æ–±—Ä–∞–±–æ—Ç–∫–∏`
- ‚úÖ –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ "User connected" - Socket.IO –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è

### –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:

1. **–°–æ–±—ã—Ç–∏—è –Ω–µ –¥–æ—Ö–æ–¥—è—Ç –¥–æ –±—ç–∫–µ–Ω–¥–∞**
   - Socket.IO –Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω –Ω–∞ –º–æ–º–µ–Ω—Ç –æ—Ç–ø—Ä–∞–≤–∫–∏
   - –ü—Ä–æ–±–ª–µ–º–∞ —Å lazy initialization
   - –°–æ–±—ã—Ç–∏—è —Ç–µ—Ä—è—é—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏

2. **–°–æ–±—ã—Ç–∏—è –¥–æ—Ö–æ–¥—è—Ç, –Ω–æ –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è**
   - –û—à–∏–±–∫–∞ –≤ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–µ (–Ω–æ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –≤–∏–¥–Ω–∞ –≤ –ª–æ–≥–∞—Ö)
   - –ü—Ä–æ–±–ª–µ–º–∞ —Å –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å—é

3. **–û—Ç–≤–µ—Ç—ã –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è, –Ω–æ –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è**
   - –ü—Ä–æ–±–ª–µ–º–∞ —Å `socket.emit("answerCreated")`
   - Socket –æ—Ç–∫–ª—é—á–∏–ª—Å—è –≤–æ –≤—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏

---

## üìã –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—é

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1 (–ö—Ä–∏—Ç–∏—á–Ω–æ)

1. **–£–≤–µ–ª–∏—á–∏—Ç—å —Ç–∞–π–º–∞—É—Ç –¥–ª—è OpenAI**
   ```typescript
   const timeout = 300000; // 5 –º–∏–Ω—É—Ç –≤–º–µ—Å—Ç–æ 60 —Å–µ–∫—É–Ω–¥
   ```

2. **–î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –≤—Å–µ—Ö —Å—Ç–∞—Ç—É—Å–æ–≤ run**
   ```typescript
   if (runObjectStatus == 'failed') {
     throw new Error(`Run failed: ${runObject.error}`);
   }
   if (runObjectStatus == 'cancelled' || runObjectStatus == 'expired') {
     throw new Error(`Run ${runObjectStatus}`);
   }
   ```

3. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ threadId/assistantId**
   ```typescript
   if (!threadId || !assistantId) {
     throw new Error('Thread or Assistant ID missing');
   }
   ```

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2 (–í–∞–∂–Ω–æ)

4. **–£–±—Ä–∞—Ç—å –¥—É–±–ª–∏—Ä—É—é—â–∏–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ `answerCreated` –≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–µ**
   - –û—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ –≤ store

5. **–î–æ–±–∞–≤–∏—Ç—å —Ç–∞–π–º–∞—É—Ç –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ**
   ```typescript
   setTimeout(() => {
     if (chatLoading) {
       set({ chatError: "Request timeout", chatLoading: false });
     }
   }, 300000); // 5 –º–∏–Ω—É—Ç
   ```

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3 (–£–ª—É—á—à–µ–Ω–∏—è)

6. **–î–æ–±–∞–≤–∏—Ç—å retry –ª–æ–≥–∏–∫—É**
7. **–•—Ä–∞–Ω–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ –ë–î**
8. **–£–ª—É—á—à–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫**

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –¢–µ—Å—Ç 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç–∞–≤–∫–∏ —Å–æ–±—ã—Ç–∏–π
1. –û—Ç–∫—Ä—ã—Ç—å –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞
2. –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ AI Assistant
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏:
   - –í –∫–æ–Ω—Å–æ–ª–∏: `[useSocketStore] sendChatMessage –≤—ã–∑–≤–∞–Ω`
   - –í –±—ç–∫–µ–Ω–¥–µ: `[Socket.IO] –ü–æ–ª—É—á–µ–Ω–æ —Å–æ–±—ã—Ç–∏–µ createMessage`

### –¢–µ—Å—Ç 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏
1. –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –±—ç–∫–µ–Ω–¥–∞:
   - `[createMessage] –ù–∞—á–∞–ª–æ –æ–±—Ä–∞–±–æ—Ç–∫–∏`
   - `[createMessage] –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∫–∏ –ø—Ä–æ–π–¥–µ–Ω–∞`
   - `[createMessage] –û–±—Ä–∞–±–æ—Ç–∫–∞ ABOUT_LEAN_CANVAS`

### –¢–µ—Å—Ç 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ OpenAI
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ `assistantId` –∏ `threadId` —Å—É—â–µ—Å—Ç–≤—É—é—Ç
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ OpenAI API –≤—ã–∑–æ–≤–æ–≤
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å—ã run

---

## üìù –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ (—Å–¥–µ–ª–∞–Ω–æ)
2. ‚è≥ –ò—Å–ø—Ä–∞–≤–∏—Ç—å —Ç–∞–π–º–∞—É—Ç OpenAI (—É–≤–µ–ª–∏—á–∏—Ç—å –¥–æ 5 –º–∏–Ω—É—Ç)
3. ‚è≥ –î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –≤—Å–µ—Ö —Å—Ç–∞—Ç—É—Å–æ–≤ run
4. ‚è≥ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ threadId/assistantId
5. ‚è≥ –£–±—Ä–∞—Ç—å –¥—É–±–ª–∏—Ä—É—é—â–∏–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫
6. ‚è≥ –î–æ–±–∞–≤–∏—Ç—å —Ç–∞–π–º–∞—É—Ç –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ
7. ‚è≥ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª–Ω—ã–π –ø–æ—Ç–æ–∫






