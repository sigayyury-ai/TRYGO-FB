# –°—Ç–∞—Ç—É—Å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ Cron Job –¥–ª—è –∞–≤—Ç–æ–ø—É–±–ª–∏–∫–∞—Ü–∏–∏

## ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

### 1. Cron Job –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞
- **–§–∞–π–ª**: `backend/src/index.ts`
- **–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ**: –ö–∞–∂–¥—ã–µ 15 –º–∏–Ω—É—Ç (`*/15 * * * *`)
- **Timezone**: UTC
- **–°—Ç–∞—Ç—É—Å**: ‚úÖ –ê–∫—Ç–∏–≤–Ω–∞

### 2. –§—É–Ω–∫—Ü–∏—è –∞–≤—Ç–æ–ø—É–±–ª–∏–∫–∞—Ü–∏–∏
- **–§–∞–π–ª**: `backend/src/services/wordpress/autoPublish.ts`
- **–§—É–Ω–∫—Ü–∏—è**: `autoPublishScheduledContent()`

### 3. –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã

#### –ü–æ–∏—Å–∫ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –¥–ª—è –ø—É–±–ª–∏–∫–∞—Ü–∏–∏:
```typescript
// –ò—â–µ—Ç —ç–ª–µ–º–µ–Ω—Ç—ã —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º "scheduled" (–≤ –ë–î) 
// –∏ scheduledDate <= —Ç–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è
const scheduledItems = await SeoBacklogIdea.find({
  status: "scheduled",
  scheduledDate: { $lte: now },
}).exec();
```

#### –£—Å–ª–æ–≤–∏—è –¥–ª—è –ø—É–±–ª–∏–∫–∞—Ü–∏–∏:
1. ‚úÖ –°—Ç–∞—Ç—É—Å backlog item = "scheduled" (–≤ –ë–î)
2. ‚úÖ `scheduledDate <= —Ç–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è`
3. ‚úÖ –ö–æ–Ω—Ç–µ–Ω—Ç –≥–æ—Ç–æ–≤: `SeoContentItem` —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º "ready"
4. ‚úÖ WordPress –Ω–∞—Å—Ç—Ä–æ–µ–Ω (baseUrl, username, appPassword)
5. ‚úÖ `autoPublishEnabled = true` –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö

#### –ü—Ä–æ—Ü–µ—Å—Å –ø—É–±–ª–∏–∫–∞—Ü–∏–∏:
1. ‚úÖ –ù–∞—Ö–æ–¥–∏—Ç –∫–æ–Ω—Ç–µ–Ω—Ç —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º "ready"
2. ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ WordPress
3. ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç `autoPublishEnabled`
4. ‚úÖ –ü—É–±–ª–∏–∫—É–µ—Ç –≤ WordPress —á–µ—Ä–µ–∑ `wordpressClient.publishPost()`
5. ‚úÖ **–ñ–¥–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –æ—Ç WordPress** (–ø—Ä–æ–≤–µ—Ä—è–µ—Ç `result.id` –∏ `result.link`)
6. ‚úÖ –û–±–Ω–æ–≤–ª—è–µ—Ç —Å—Ç–∞—Ç—É—Å `SeoContentItem` –Ω–∞ "published" (—Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è)
7. ‚úÖ –û–±–Ω–æ–≤–ª—è–µ—Ç —Å—Ç–∞—Ç—É—Å `SeoBacklogIdea` –Ω–∞ "in_progress" (–æ—Å—Ç–∞–µ—Ç—Å—è –≤ —Å–ø—Ä–∏–Ω—Ç–µ)

### 4. –ú–∞–ø–ø–∏–Ω–≥ —Å—Ç–∞—Ç—É—Å–æ–≤

**–í –ë–î (MongoDB):**
- `"scheduled"` - —ç–ª–µ–º–µ–Ω—Ç –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω
- `"in_progress"` - —ç–ª–µ–º–µ–Ω—Ç –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω (–æ—Å—Ç–∞–µ—Ç—Å—è –≤ —Å–ø—Ä–∏–Ω—Ç–µ)
- `"ready"` - –∫–æ–Ω—Ç–µ–Ω—Ç –≥–æ—Ç–æ–≤ –∫ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏
- `"published"` - –∫–æ–Ω—Ç–µ–Ω—Ç –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω

**–í GraphQL/Frontend:**
- `"SCHEDULED"` - —ç–ª–µ–º–µ–Ω—Ç –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω
- `"IN_PROGRESS"` - —ç–ª–µ–º–µ–Ω—Ç –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω
- –ú–∞–ø–ø–∏–Ω–≥ —á–µ—Ä–µ–∑ `mapBacklogStatus()` –≤ `resolvers.ts`

### 5. Endpoint –¥–ª—è —Ä—É—á–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞
- **URL**: `POST /auto-publish`
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –ú–æ–∂–Ω–æ –≤—ã–∑–≤–∞—Ç—å –≤—Ä—É—á–Ω—É—é –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- **–û—Ç–≤–µ—Ç**: `{ published: number, failed: number, errors: string[] }`

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

### –õ–æ–≥–∏ cron job:
```
[cron] üîÑ –ó–∞–ø—É—Å–∫ –∞–≤—Ç–æ–ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é...
[autoPublish] ===== –ù–ê–ß–ê–õ–û –ê–í–¢–û–ü–£–ë–õ–ò–ö–ê–¶–ò–ò =====
[autoPublish] –¢–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è: 2024-01-15T10:00:00.000Z
[autoPublish] –ù–∞–π–¥–µ–Ω–æ X —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –¥–ª—è –ø—É–±–ª–∏–∫–∞—Ü–∏–∏
[cron] ‚úÖ –ê–≤—Ç–æ–ø—É–±–ª–∏–∫–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞: { published: X, failed: 0, errors: [] }
```

### –õ–æ–≥–∏ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ —ç–ª–µ–º–µ–Ω—Ç–∞:
```
[autoPublish] –û–±—Ä–∞–±–æ—Ç–∫–∞ —ç–ª–µ–º–µ–Ω—Ç–∞: <id> - "<title>"
[autoPublish] ‚úÖ –ö–æ–Ω—Ç–µ–Ω—Ç –Ω–∞–π–¥–µ–Ω: <contentId>, —Å—Ç–∞—Ç—É—Å: ready
[autoPublish] ‚úÖ WordPress –Ω–∞—Å—Ç—Ä–æ–µ–Ω, –∞–≤—Ç–æ–ø—É–±–ª–∏–∫–∞—Ü–∏—è –≤–∫–ª—é—á–µ–Ω–∞
[autoPublish] ===== –ù–ê–ß–ê–õ–û –ü–£–ë–õ–ò–ö–ê–¶–ò–ò =====
[autoPublish] ‚úÖ WordPress –ø–æ–¥—Ç–≤–µ—Ä–¥–∏–ª –ø—É–±–ª–∏–∫–∞—Ü–∏—é: { postId: X, link: "..." }
[autoPublish] ‚úÖ Content item —Å—Ç–∞—Ç—É—Å –æ–±–Ω–æ–≤–ª–µ–Ω –Ω–∞ "published"
[autoPublish] ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω —Å—Ç–∞—Ç—É—Å backlog item –Ω–∞ IN_PROGRESS
[autoPublish] ===== –ü–£–ë–õ–ò–ö–ê–¶–ò–Ø –ó–ê–í–ï–†–®–ï–ù–ê –£–°–ü–ï–®–ù–û =====
```

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã

1. **–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –æ—Ç WordPress**: –°—Ç–∞—Ç—É—Å –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –Ω–∞ "published" –¢–û–õ–¨–ö–û –ø–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è `result.id` –∏ `result.link` –æ—Ç WordPress API
2. **–û—Å—Ç–∞–µ—Ç—Å—è –≤ —Å–ø—Ä–∏–Ω—Ç–µ**: –ü–æ—Å–ª–µ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ —ç–ª–µ–º–µ–Ω—Ç –æ—Å—Ç–∞–µ—Ç—Å—è –≤ —Å–ø—Ä–∏–Ω—Ç–µ —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º "in_progress" (–Ω–µ –∞—Ä—Ö–∏–≤–∏—Ä—É–µ—Ç—Å—è)
3. **–ß–∞—Å—Ç–æ—Ç–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏**: –ö–∞–∂–¥—ã–µ 15 –º–∏–Ω—É—Ç - —ç—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ —ç–ª–µ–º–µ–Ω—Ç –º–æ–∂–µ—Ç –±—ã—Ç—å –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π –¥–æ 15 –º–∏–Ω—É—Ç –ø–æ—Å–ª–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏
4. **–ê–≤—Ç–æ–ø—É–±–ª–∏–∫–∞—Ü–∏—è –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –≤–∫–ª—é—á–µ–Ω–∞**: –í –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö (`SeoPostingSettingsPanel`) –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –≤–∫–ª—é—á–µ–Ω–∞ –æ–ø—Ü–∏—è `autoPublishEnabled`

## üìù –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

1. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**: –ú–æ–∂–Ω–æ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —á–µ—Ä–µ–∑ endpoint `POST /auto-publish`
2. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**: –°–ª–µ–¥–∏—Ç—å –∑–∞ –ª–æ–≥–∞–º–∏ cron job –¥–ª—è –≤—ã—è–≤–ª–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º
3. **–ß–∞—Å—Ç–æ—Ç–∞**: –ï—Å–ª–∏ –Ω—É–∂–Ω–∞ –±–æ–ª–µ–µ —Ç–æ—á–Ω–∞—è –ø—É–±–ª–∏–∫–∞—Ü–∏—è, –º–æ–∂–Ω–æ —É–º–µ–Ω—å—à–∏—Ç—å –∏–Ω—Ç–µ—Ä–≤–∞–ª (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç)

